{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/logger.ts","webpack:///./src/message-bus.ts","webpack:///./src/spotify/agent.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","LogLevel","Logger","this","_name","window","logLevel","Info","debug","message","params","_level","Debug","console","log","__assign","timestamp","Date","component","info","warn","Warn","error","Error","default","Bus","_this","_subscriptions","chrome","runtime","onMessage","addListener","request","sender","sendResponse","type","filter","forEach","callback","on","push","send","sendMessage","response","logger_1","message_bus_1","Agent","_player","document","querySelector","_logger","_bus","_track","_clickAt","elem","x","box","getBoundingClientRect","offset","down","createEvent","up","initMouseEvent","y","undefined","dispatchEvent","isReady","GetTrackInfo","artist","GetArtist","title","GetTitle","art","GetArt","progress","GetProgress","elapsed","GetElapsed","length","GetLength","volume","GetVolume","shuffle_on","GetShuffleState","repeat_on","GetRepeatState","mute_on","GetMuteState","is_paused","GetPauseState","is_saved","GetSavedState","Toggle","playButton","click","Next","Previous","Repeat","Shuffle","Mute","Save","saveButton","unsaveButton","feedback","song","Forward","current","Rewind","Backward","target","offsetWidth","SetVolume","text","style","backgroundImage","slice","t1","split","map","t2","innerHTML","all","querySelectorAll","bar","prog","width","classList","contains","repeatButton","agent"],"mappings":"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","file":"agent.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","export class Logger {\r\n  get _level(): LogLevel {\r\n    if (typeof (window) !== \"undefined\") return (window as any).logLevel || LogLevel.Info;\r\n    return LogLevel.Info\r\n  }\r\n\r\n  private _name: string;\r\n\r\n  constructor(name: string) {\r\n    this._name = name;\r\n  }\r\n\r\n  public debug(message: any, params?: any) {\r\n    if (this._level > LogLevel.Debug) return;\r\n    // tslint:disable-next-line:no-console\r\n    console.log(message, { timestamp: new Date(), component: this._name, ...params });\r\n  }\r\n\r\n  public info(message: any, params?: any) {\r\n    if (this._level > LogLevel.Info) return;\r\n    // tslint:disable-next-line:no-console\r\n    console.info(message, { timestamp: new Date(), component: this._name, ...params });\r\n  }\r\n\r\n  public warn(message: any, params?: any) {\r\n    if (this._level > LogLevel.Warn) return;\r\n    // tslint:disable-next-line:no-console\r\n    console.warn(message, { timestamp: new Date(), component: this._name, ...params });\r\n  }\r\n\r\n  public error(message: any, params?: any) {\r\n    if (this._level > LogLevel.Error) return;\r\n    // tslint:disable-next-line:no-console\r\n    console.error(message, { timestamp: new Date(), component: this._name, ...params });\r\n  }\r\n}\r\n\r\nexport enum LogLevel {\r\n  None,\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error\r\n}\r\n\r\nexport default Logger;","export class Bus {\r\n    private _subscriptions: Subscription[];\r\n\r\n    constructor() {\r\n        this._subscriptions = [];\r\n        chrome.runtime.onMessage.addListener(\r\n            (request, sender, sendResponse) => {\r\n                if (typeof request.type === \"undefined\")\r\n                    return;\r\n                this._subscriptions\r\n                    .filter((s: Subscription) => {\r\n                        return s.type === request.type;\r\n                    })\r\n                    .forEach((s: Subscription) => {\r\n                        s.callback(request.message);\r\n                    });\r\n            });\r\n    }\r\n\r\n    public on(type: string, callback: callbackType) {\r\n        this._subscriptions.push({ type: type, callback: callback });\r\n    }\r\n\r\n    public send(type: string, message?: any) {\r\n        this._subscriptions\r\n            .filter((s) => s.type === type)\r\n            .forEach((s) => {\r\n                s.callback(message);\r\n            });\r\n        // tslint:disable-next-line:no-empty\r\n        chrome.runtime.sendMessage({ type: type, message: message }, (response) => { });\r\n    }\r\n}\r\n\r\ninterface Subscription {\r\n    type: string;\r\n    callback: callbackType;\r\n}\r\n\r\ntype callbackType = (message?: any) => void;\r\n","import { Logger } from \"logger\";\r\nimport { Track } from \"track\";\r\nimport { Bus } from \"message-bus\";\r\n\r\nclass Agent {\r\n  private _player: Element = document.querySelector(\".now-playing-bar\");\r\n  private _logger = new Logger(\"Agent\");\r\n  private _bus = new Bus();\r\n\r\n  private _track: any = {\r\n  };\r\n\r\n  constructor() {\r\n    this._logger.info(\"Agent planted\");\r\n  }\r\n\r\n  public isReady() {\r\n    if (!this._player) this._player = document.querySelector(\".now-playing-bar\");\r\n    if (!this._player) return false;\r\n    return true;\r\n  }\r\n\r\n  public GetTrackInfo(): Track {\r\n    if (!this.isReady())\r\n      return undefined;\r\n\r\n    return {\r\n      artist: this.GetArtist(),\r\n      title: this.GetTitle(),\r\n      art: this.GetArt(),\r\n      progress: this.GetProgress(),\r\n      elapsed: this.GetElapsed(),\r\n      length: this.GetLength(),\r\n      volume: this.GetVolume(),\r\n      shuffle_on: this.GetShuffleState(),\r\n      repeat_on: this.GetRepeatState(),\r\n      mute_on: this.GetMuteState(),\r\n      is_paused: this.GetPauseState(),\r\n      is_saved: this.GetSavedState()\r\n    };\r\n  }\r\n\r\n  public Toggle() {\r\n    let playButton = (this._player.querySelector(\".spoticon-pause-16\") as HTMLElement);\r\n    if (!playButton) playButton = (this._player.querySelector(\".spoticon-play-16\") as HTMLElement);\r\n    playButton.click();\r\n\r\n    if (!this.GetPauseState()) {\r\n      this._bus.send(\"idea.evt.player.playing\");\r\n    }\r\n  }\r\n\r\n  public Next() {\r\n    (this._player.querySelector(\".spoticon-skip-forward-16\") as HTMLElement).click();\r\n  }\r\n\r\n  public Previous() {\r\n    (this._player.querySelector(\".spoticon-skip-back-16\") as HTMLElement).click();\r\n  }\r\n\r\n  public Repeat() {\r\n    ((this._player.querySelector(\".spoticon-repeat-16\") as HTMLElement) || (this._player.querySelector(\".spoticon-repeatonce-16\") as HTMLElement)).click();\r\n  }\r\n\r\n  public Shuffle() {\r\n    (this._player.querySelector(\".spoticon-shuffle-16\") as HTMLElement).click();\r\n  }\r\n\r\n  public Mute() {\r\n    (this._player.querySelector(\".volume-bar button\") as HTMLElement).click();\r\n  }\r\n\r\n  public Save() {\r\n    let saveButton = (this._player.querySelector(\".spoticon-heart-16\") as HTMLElement);\r\n    let unsaveButton = (this._player.querySelector(\".spoticon-heart-active-16\") as HTMLElement);\r\n    (saveButton || unsaveButton).click();\r\n\r\n    this._bus.send(\"idea.evt.player.saved\", {\r\n      feedback: saveButton ? \"Added to your Favorite Songs\" : \"Removed from your Favorite Songs\",\r\n      song: `${this.GetArtist()} - ${this.GetTitle()}`,\r\n      art: this.GetArt()\r\n    });\r\n  }\r\n\r\n  public Forward() {\r\n    var current = this.GetProgress();\r\n    this._logger.info(\"forward\", { current });\r\n    this.Rewind(current >= 0.9 ? 0.99 : current + 0.1);\r\n  }\r\n  public Backward() {\r\n    var current = this.GetProgress();\r\n    this._logger.info(\"backward\", { current });\r\n    this.Rewind(current <= 0.1 ? 0.01 : current - 0.1);\r\n  }\r\n  \r\n  public Rewind(target: number) {\r\n    let elem = (this._player.querySelector(\".playback-bar .progress-bar\") as HTMLElement);\r\n    this._logger.info(\"rewinding\", { target });\r\n    this._clickAt(elem, elem.offsetWidth * target);\r\n  }\r\n\r\n  public SetVolume(target: number) {\r\n    let elem = (this._player.querySelector(\".volume-bar .progress-bar\") as HTMLElement);\r\n    this._logger.info(elem);\r\n    this._logger.info(\"rewinding to target\" + target);\r\n    this._clickAt(elem, elem.offsetWidth * target);\r\n  }\r\n\r\n  public GetArtist() {\r\n    try {\r\n      return (this._player.querySelector(\".track-info__artists a\") as HTMLAnchorElement).text;\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetTitle() {\r\n    try {\r\n      return (this._player.querySelector(\".track-info__name a\") as HTMLAnchorElement).text;\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetArt() {\r\n    try {\r\n      let art = (this._player.querySelector(\".cover-art-image\") as HTMLAnchorElement).style.backgroundImage;\r\n      return art.slice(5, art.length - 2);\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetProgress() {\r\n    try {\r\n      let t1 = this.GetElapsed().split(\":\").map((t) => ~~t);\r\n      let elapsed = t1[0] * 60 + t1[1];\r\n\r\n      let t2 = this.GetLength().split(\":\").map((t) => ~~t);\r\n      let total = t2[0] > 0 ? t2[0] * 60 + t2[1] : t2[0] * 60 * -1 + t2[1] + elapsed;\r\n\r\n      return elapsed / total;\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetElapsed() {\r\n    try {\r\n      return this._player.querySelector(\".playback-bar__progress-time\").innerHTML;\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetLength() {\r\n    try {\r\n      let all = this._player.querySelectorAll(\".playback-bar__progress-time\");\r\n      return all[all.length - 1].innerHTML;\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetVolume() {\r\n    try {\r\n      var bar = this._player.querySelector(\".volume-bar .progress-bar__fg_wrapper\").getBoundingClientRect() as DOMRect;\r\n      var prog = this._player.querySelector(\".volume-bar .progress-bar__fg\").getBoundingClientRect() as DOMRect;\r\n      return 1 - (bar.x - prog.x) / bar.width\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetShuffleState() {\r\n    try {\r\n      let shuffleButton = this._player.querySelector(\".spoticon-shuffle-16\");\r\n      return shuffleButton.classList.contains(\"control-button--active\");\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetRepeatState() {\r\n    try {\r\n      let repeatButton = this._player.querySelector(\".spoticon-repeat-16\");\r\n      if (!repeatButton) repeatButton = this._player.querySelector(\".spoticon-repeatonce-16\");\r\n      return repeatButton.classList.contains(\"control-button--active\");\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetMuteState() {\r\n    try {\r\n      let repeatButton = this._player.querySelector(\".volume-bar button\");\r\n      return repeatButton.classList.contains(\"spoticon-volume-off-16\");\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetPauseState() {\r\n    try {\r\n      return !!this._player.querySelector(\".spoticon-pause-16\");\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  public GetSavedState() {\r\n    try {\r\n      return !!this._player.querySelector(\".spoticon-heart-active-16\");\r\n    } catch (error) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private _clickAt = (elem: HTMLElement, x: number) => {\r\n    let box = elem.getBoundingClientRect() as DOMRect;\r\n    this._logger.info(\"click at\", { x, offset: (box.x + x) });\r\n    let down = document.createEvent(\"MouseEvents\");\r\n    let up = document.createEvent(\"MouseEvents\");\r\n    down.initMouseEvent(\"mousedown\", true, true, window, null, 0, 0, box.x + x, box.y, false, false, false, false, 0, undefined);\r\n    up.initMouseEvent(\"mouseup\", true, true, window, null, 0, 0, box.x + x, box.y, false, false, false, false, 0, undefined);\r\n    elem.dispatchEvent(down);\r\n    elem.dispatchEvent(up);\r\n  }\r\n}\r\n\r\n(window as any).agent = new Agent();\r\n"],"sourceRoot":""}