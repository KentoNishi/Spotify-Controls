{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/logger.ts","webpack:///./src/message-bus.ts","webpack:///./src/storage.ts","webpack:///./src/asynchrome.ts","webpack:///./src/utils.ts","webpack:///./src/background.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","LogLevel","Logger","this","_name","window","logLevel","Info","debug","message","params","_level","Debug","console","log","__assign","timestamp","Date","component","info","warn","Warn","error","Error","default","Bus","_this","_subscriptions","chrome","runtime","onMessage","addListener","request","sender","sendResponse","type","filter","forEach","callback","on","push","send","sendMessage","response","Storage","Get","Promise","resolve","reject","storage","local","flag","Set","set","_a","Remove","remove","logger_1","storage_1","utils_1","Tabs","tabId","tabs","tab","find","query","test","url","queryInfo","executeScript","details","update","updateProperties","getCurrent","toggleMute","sent","newState","mutedInfo","muted","Notifications","clear","notificationId","notifications","isCleared","prefix","options","_logger","newGuid","id","duration","delay","s4","Math","floor","random","toString","substring","ms","setTimeout","getChromeVersion","raw","navigator","userAgent","match","parseInt","asynchrome_1","message_bus_1","Process","_bus","heartBeatInterval","_cacheArtist","_cacheTitle","registerHotKeys","subscribe","__awaiter","__generator","heartBeat","_heartBeatInterval","setInterval","plantAgent","length","pattern","commands","onCommand","cmd","onButtonClicked","buttonIndex","evt","code","location","level","tracks","iconUrl","art","title","artist","progress","round","buttons","getLyrics","feedback","song","fetch","text","data","eval","lyric","lyrics","toLowerCase","indexOf","lines","split","line","replace","splice","lyr","track","trackChanged","artWorkReady","process"],"mappings":"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","file":"background.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","export class Logger {\r\n  get _level(): LogLevel {\r\n    if (typeof (window) !== \"undefined\") return (window as any).logLevel || LogLevel.Info;\r\n    return LogLevel.Info\r\n  }\r\n\r\n  private _name: string;\r\n\r\n  constructor(name: string) {\r\n    this._name = name;\r\n  }\r\n\r\n  public debug(message: any, params?: any) {\r\n    if (this._level > LogLevel.Debug) return;\r\n    // tslint:disable-next-line:no-console\r\n    console.log(message, { timestamp: new Date(), component: this._name, ...params });\r\n  }\r\n\r\n  public info(message: any, params?: any) {\r\n    if (this._level > LogLevel.Info) return;\r\n    // tslint:disable-next-line:no-console\r\n    console.info(message, { timestamp: new Date(), component: this._name, ...params });\r\n  }\r\n\r\n  public warn(message: any, params?: any) {\r\n    if (this._level > LogLevel.Warn) return;\r\n    // tslint:disable-next-line:no-console\r\n    console.warn(message, { timestamp: new Date(), component: this._name, ...params });\r\n  }\r\n\r\n  public error(message: any, params?: any) {\r\n    if (this._level > LogLevel.Error) return;\r\n    // tslint:disable-next-line:no-console\r\n    console.error(message, { timestamp: new Date(), component: this._name, ...params });\r\n  }\r\n}\r\n\r\nexport enum LogLevel {\r\n  None,\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error\r\n}\r\n\r\nexport default Logger;","export class Bus {\r\n    private _subscriptions: Subscription[];\r\n\r\n    constructor() {\r\n        this._subscriptions = [];\r\n        chrome.runtime.onMessage.addListener(\r\n            (request, sender, sendResponse) => {\r\n                if (typeof request.type === \"undefined\")\r\n                    return;\r\n                this._subscriptions\r\n                    .filter((s: Subscription) => {\r\n                        return s.type === request.type;\r\n                    })\r\n                    .forEach((s: Subscription) => {\r\n                        s.callback(request.message);\r\n                    });\r\n            });\r\n    }\r\n\r\n    public on(type: string, callback: callbackType) {\r\n        this._subscriptions.push({ type: type, callback: callback });\r\n    }\r\n\r\n    public send(type: string, message?: any) {\r\n        this._subscriptions\r\n            .filter((s) => s.type === type)\r\n            .forEach((s) => {\r\n                s.callback(message);\r\n            });\r\n        // tslint:disable-next-line:no-empty\r\n        chrome.runtime.sendMessage({ type: type, message: message }, (response) => { });\r\n    }\r\n}\r\n\r\ninterface Subscription {\r\n    type: string;\r\n    callback: callbackType;\r\n}\r\n\r\ntype callbackType = (message?: any) => void;\r\n","type KeyLiteral = \"lyric\" | \"track\" | \"rated\" | \"donated\" | \"notifications-disabled\"| \"notifications-duration\" | \"notifications-play-disabled\";\r\n\r\nexport class Storage {\r\n    public static async Get<T>(key: KeyLiteral): Promise<T> {\r\n        return new Promise<T>((resolve, reject) => {\r\n            chrome.storage.local.get(key, (flag) => {\r\n                resolve(flag[key] as T);\r\n            });\r\n        });\r\n    }\r\n\r\n    public static Set<T>(key: KeyLiteral, value: T) {\r\n        chrome.storage.local.set({ [key]: value });\r\n    }\r\n\r\n    public static Remove(key: KeyLiteral) {\r\n        chrome.storage.local.remove(key);\r\n    }\r\n}\r\n","import { Logger } from \"./logger\";\r\nimport { Storage } from \"./storage\";\r\nimport { delay, newGuid } from \"./utils\";\r\nimport { IConfig } from \"config\";\r\n\r\ndeclare const __CONFIG__: IConfig;\r\n\r\nexport class Tabs {\r\n  public static get(tabId: number): Promise<chrome.tabs.Tab> {\r\n    return new Promise((resolve, reject) => {\r\n      chrome.tabs.get(tabId, (tab) => {\r\n        resolve(tab);\r\n      });\r\n    });\r\n  }\r\n  public static find(): Promise<chrome.tabs.Tab[]> {\r\n    return new Promise((resolve, reject) => {\r\n      chrome.tabs.query({}, (tabs) => {\r\n        resolve(tabs.filter(t => __CONFIG__.tabUrlRegEx.test(t.url)));\r\n      });\r\n    });\r\n  }\r\n  public static query(queryInfo: chrome.tabs.QueryInfo): Promise<chrome.tabs.Tab[]> {\r\n    return new Promise((resolve, reject) => {\r\n      chrome.tabs.query(queryInfo, (tabs) => {\r\n        resolve(tabs);\r\n      });\r\n    });\r\n  }\r\n  public static executeScript<T>(tabId: number, details: chrome.tabs.InjectDetails): Promise<T[]> {\r\n    return new Promise((resolve, reject) => {\r\n      chrome.tabs.executeScript(tabId, details, (tabs) => {\r\n        resolve(tabs);\r\n      });\r\n    });\r\n  }\r\n\r\n  public static update(tabId: number, updateProperties: chrome.tabs.UpdateProperties): Promise<chrome.tabs.Tab> {\r\n    return new Promise((resolve, reject) => {\r\n      chrome.tabs.update(tabId, updateProperties, (tab) => {\r\n        resolve(tab);\r\n      });\r\n    });\r\n  }\r\n  public static getCurrent(): Promise<chrome.tabs.Tab> {\r\n    return new Promise((resolve, reject) => {\r\n      chrome.tabs.getCurrent((tab) => {\r\n        resolve(tab);\r\n      });\r\n    });\r\n  }\r\n\r\n  public static async toggleMute(tabId: number): Promise<boolean> {\r\n    let info = await Tabs.get(tabId);\r\n    let newState = !info.mutedInfo.muted;\r\n    await this.update(tabId, { muted: newState });\r\n    return newState;\r\n  }\r\n}\r\n\r\nexport class Notifications {\r\n  private static _logger = new Logger(\"Notifications Process\");\r\n\r\n  public static clear(notificationId: string): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      chrome.notifications.clear(notificationId, (isCleared) => {\r\n        resolve(isCleared);\r\n      });\r\n    });\r\n  }\r\n\r\n  public static async create(prefix: string, options: chrome.notifications.NotificationOptions) {\r\n\r\n    this._logger.info(\"Notifications enabled - displaying\", options);\r\n\r\n    let notificationId = await new Promise<string>((resolve, reject) => {\r\n      chrome.notifications.create(`${prefix}-${newGuid()}`, options, (id) => {\r\n        resolve(id);\r\n      });\r\n    });\r\n\r\n    let duration = await Storage.Get<number>(\"notifications-duration\");\r\n    await delay((duration || 3) * 1000);\r\n\r\n    await Notifications.clear(notificationId);\r\n  }\r\n}\r\n","export function newGuid(): string {\r\n  function s4() {\r\n    return Math.floor((1 + Math.random()) * 0x10000)\r\n      .toString(16)\r\n      .substring(1);\r\n  }\r\n  return s4() + s4() + \"-\" + s4() + \"-\" + s4() + \"-\" +\r\n    s4() + \"-\" + s4() + s4() + s4();\r\n}\r\n\r\nexport function delay(ms: number) {\r\n  return new Promise<void>((resolve) => {\r\n    setTimeout(resolve, ms);\r\n  });\r\n}\r\n\r\nexport function getChromeVersion() {\r\n  var raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./);\r\n  return raw ? parseInt(raw[2], 10) : false;\r\n}\r\n","import { Notifications, Tabs } from \"./asynchrome\";\r\nimport { Logger } from \"./logger\";\r\nimport { Lyric } from \"./lyric\";\r\nimport { Bus } from \"./message-bus\";\r\nimport { Storage } from \"./storage\";\r\nimport { Track } from \"./track\";\r\nimport { IConfig } from \"config\";\r\ndeclare const __CONFIG__: IConfig;\r\n\r\nclass Process {\r\n\r\n  private _bus: Bus = new Bus();\r\n  private _logger = new Logger(\"Background Process\");\r\n\r\n  private heartBeatInterval: number = null;\r\n  private tabId: number = null;\r\n\r\n  private _cacheArtist: string = null;\r\n  private _cacheTitle: string = null;\r\n  private _heartBeatInterval: any;\r\n\r\n  constructor() {\r\n\r\n    this.registerHotKeys();\r\n    this.subscribe();\r\n\r\n    (async () => { await this.heartBeat(); })();\r\n    this._heartBeatInterval = setInterval(() => {\r\n      (async () => { await this.heartBeat(); })();\r\n    }, 700);\r\n  }\r\n\r\n  public async plantAgent() {\r\n    this._logger.debug(\"Planting Agent\");\r\n\r\n    let tabs = await Tabs.find();\r\n\r\n    if (tabs.length < 1) {\r\n      this._logger.error(\"Player tab not found\", { pattern: __CONFIG__.tabUrlRegEx });\r\n      return;\r\n    }\r\n\r\n    this.tabId = tabs[0].id;\r\n    this._logger.debug(`Tab ID ${this.tabId}`, { tabs });\r\n  }\r\n\r\n  private registerHotKeys() {\r\n    this._logger.info(\"Registering hotkeys\");\r\n\r\n    chrome.commands.onCommand.addListener((cmd) => {\r\n      switch (cmd) {\r\n        case \"player-toggle\":\r\n          this._bus.send(\"idea.cmd.player.toggle\");\r\n          break;\r\n        case \"player-next\":\r\n          this._bus.send(\"idea.cmd.player.next\");\r\n          break;\r\n        case \"player-previous\":\r\n          this._bus.send(\"idea.cmd.player.previous\");\r\n          break;\r\n        case \"player-forward\":\r\n          this._bus.send(\"idea.cmd.player.forward\");\r\n          break;\r\n        case \"player-backward\":\r\n          this._bus.send(\"idea.cmd.player.backward\");\r\n          break;\r\n        case \"player-mute\":\r\n          this._bus.send(\"idea.cmd.player.mute\");\r\n          break;\r\n        case \"player-shuffle\":\r\n          this._bus.send(\"idea.cmd.player.shuffle\");\r\n          break;\r\n        case \"player-repeat\":\r\n          this._bus.send(\"idea.cmd.player.repeat\");\r\n          break;\r\n        case \"player-save\":\r\n          this._bus.send(\"idea.cmd.player.save\");\r\n          break;\r\n        case \"player-show\":\r\n          this._bus.send(\"idea.cmd.player.show\");\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n\r\n    chrome.notifications.onButtonClicked.addListener((notificationId: string, buttonIndex: number) => {\r\n      this._logger.info(\"Notification button clicked\", { notificationId, buttonIndex });\r\n      this._bus.send(`idea.cmd.player.${buttonIndex == 0 ? \"previous\" : \"next\"}`);\r\n    });\r\n  }\r\n\r\n  private subscribe() {\r\n    this._logger.info(\"Subscribing\");\r\n\r\n    this._bus.on(\"idea.cmd.player.rewind\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: `agent.Rewind(${evt.location})` });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.forward\", async () => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: `agent.Forward()` });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.backward\", async () => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: `agent.Backward()` });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.volume\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: `agent.SetVolume(${evt.level})` });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.toggle\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: \"agent.Toggle()\" });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.next\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: \"agent.Next()\" });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.previous\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: \"agent.Previous()\" });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.shuffle\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: \"agent.Shuffle()\" });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.repeat\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: \"agent.Repeat()\" });\r\n    });\r\n    this._bus.on(\"idea.cmd.player.mute\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      if (__CONFIG__.environment === \"amazon\") {\r\n        await Tabs.toggleMute(this.tabId);\r\n      } else {\r\n        await Tabs.executeScript(this.tabId, { code: `agent.Mute(${this.tabId})` });\r\n      }\r\n    });\r\n    this._bus.on(\"idea.cmd.player.save\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      await Tabs.executeScript(this.tabId, { code: \"agent.Save()\" });\r\n    });\r\n\r\n    this._bus.on(\"idea.cmd.player.show\", async (evt: any) => {\r\n      if (!this.tabId) return;\r\n      let tracks = await Tabs.executeScript<Track>(this.tabId, { code: \"agent.GetTrackInfo()\" });\r\n      if (!tracks || tracks.length < 1 || !tracks[0]) return;\r\n\r\n\r\n      let options: chrome.notifications.NotificationOptions = {\r\n        type: \"progress\",\r\n        iconUrl: tracks[0].art,\r\n        title: tracks[0].title,\r\n        message: tracks[0].artist,\r\n        progress: Math.round(tracks[0].progress * 100),\r\n        buttons: [{ title: \"previous\" }, { title: \"next\" }]\r\n      };\r\n\r\n      await Notifications.create(\"progress\", options);\r\n    });\r\n\r\n    this._bus.on(\"idea.track.changed\", async (evt: Track) => {\r\n      let options = {\r\n        type: \"basic\",\r\n        iconUrl: evt.art,\r\n        title: evt.title,\r\n        message: evt.artist,\r\n        buttons: [{ title: \"previous\" }, { title: \"next\" }]\r\n      };\r\n\r\n      if (await Storage.Get<boolean>(\"notifications-disabled\")) {\r\n        this._logger.info(\"Notifications for track change disabled - skipping\");\r\n      } else {\r\n        await Notifications.create(\"next\", options);\r\n      }\r\n    });\r\n\r\n    this._bus.on(\"idea.evt.player.playing\", async (evt: Track) => {\r\n\r\n      if (!this.tabId) return;\r\n      let tracks = await Tabs.executeScript<Track>(this.tabId, { code: \"agent.GetTrackInfo()\" });\r\n      if (!tracks || tracks.length < 1 || !tracks[0]) return;\r\n\r\n      let options = {\r\n        type: \"progress\",\r\n        iconUrl: tracks[0].art,\r\n        title: tracks[0].title,\r\n        message: tracks[0].artist,\r\n        progress: Math.round(tracks[0].progress * 100),\r\n        buttons: [{ title: \"previous\" }, { title: \"next\" }]\r\n      };\r\n\r\n      if (await Storage.Get<boolean>(\"notifications-play-disabled\")) {\r\n        this._logger.info(\"Notifications for play disabled - skipping\");\r\n      } else {\r\n        await Notifications.create(\"playing\", options);\r\n      }\r\n    });\r\n\r\n    this._bus.on(\"idea.track.changed\", async (evt: any) => {\r\n\r\n      await this.getLyrics(evt.artist, evt.title);\r\n    });\r\n\r\n    this._bus.on(\"idea.evt.player.saved\", async (evt: any) => {\r\n      let options = {\r\n        type: \"basic\",\r\n        iconUrl: evt.art,\r\n        title: evt.feedback,\r\n        message: evt.song,\r\n        buttons: [{ title: \"previous\" }, { title: \"next\" }]\r\n      };\r\n      Notifications.create(\"saved\", options);\r\n    });\r\n\r\n  }\r\n\r\n  private async getLyrics(artist: string, title: string) {\r\n    this._logger.info(\"Getting lyrics\");\r\n\r\n    let response = await window.fetch(\"http://lyrics.wikia.com/api.php?action=lyrics&artist=\" + artist + \"&song=\" + title + \"&fmt=json\");\r\n    let data = await response.text();\r\n    // tslint:disable-next-line:no-eval\r\n    let song = eval(data);\r\n    let lyric: Lyric = song;\r\n\r\n    if (lyric.lyrics.toLowerCase() === \"not found\") {\r\n      Storage.Remove(\"lyric\");\r\n      if (title.indexOf(\" - \") > -1)\r\n        await this.getLyrics(artist, title.substring(0, title.indexOf(\" - \")));\r\n    } else {\r\n      let lines = lyric.lyrics\r\n        .split(/\\r\\n|\\r|\\n/)\r\n        .filter((line: any) => line.replace(/\\s/g, \"\") === \"\" ? false : true)\r\n        .splice(0, 4);\r\n\r\n      let lyr = \"\";\r\n      for (let i in lines) {\r\n        if (lines.hasOwnProperty(i)) {\r\n          if (lyr.length > 120) break;\r\n          lyr += (\"\\r\\n\" + lines[i].replace(\"[...]\", \"\"));\r\n        }\r\n      }\r\n      lyric.lyrics = lyr + \"..\";\r\n\r\n      Storage.Set<Lyric>(\"lyric\", lyric);\r\n    }\r\n  }\r\n\r\n  private async heartBeat() {\r\n    this._logger.debug(\"Heartbeat\");\r\n\r\n    if (!this.tabId) {\r\n      this._logger.warn(\"Tab ID not set\");\r\n      await this.plantAgent();\r\n      return;\r\n    }\r\n\r\n    let tab = await Tabs.get(this.tabId);\r\n    if (!tab) {\r\n      this.tabId = null;\r\n      this._logger.warn(\"Tab ID not found\", { tabId: this.tabId });\r\n      await this.plantAgent();\r\n      return;\r\n    }\r\n\r\n    this._logger.debug(\"Tab ID found\", { tabId: this.tabId });\r\n\r\n    let tracks = (await Tabs.executeScript(this.tabId, { code: \"agent.GetTrackInfo()\" })) as Track[];\r\n\r\n    if (!tracks || tracks.length < 1 || !tracks[0]) {\r\n      this._logger.debug(\"Agent returned no track info\", { tabId: this.tabId, tracks: tracks });\r\n      await this.plantAgent();\r\n      return;\r\n    }\r\n\r\n    let track = tracks[0];\r\n\r\n    this._bus.send(\"idea.track.updated\", track);\r\n\r\n    let trackChanged = this._cacheArtist !== track.artist || this._cacheTitle !== track.title;\r\n    let artWorkReady = track.art && track.art !== \"\";\r\n\r\n    if (trackChanged && artWorkReady) {\r\n      this._cacheArtist = track.artist;\r\n      this._cacheTitle = track.title;\r\n\r\n      this._bus.send(\"idea.track.changed\", track);\r\n    }\r\n  }\r\n}\r\n\r\nlet process = new Process();\r\n"],"sourceRoot":""}